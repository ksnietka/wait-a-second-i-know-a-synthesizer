<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>

    <canvas id="frequency" width="800" height="600"></canvas>
    <input type="range" id="osc1-range" min="0" max="1000">
    <input type="range" id="osc2-range" min="0" max="1000">
    <input type="range" id="filter-range" min="0" max="5000">
    <input type="range" id="filter-q" min="0" max="100">

<script>

    let osc1, osc2, filter, analyser, bufferLength, frequencyInfo, timeInfo, canvas, canvCtx;

    function initOscillator() {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();

        osc1 = ctx.createOscillator();
        osc2 = ctx.createOscillator();
        osc2.detune.linearRampToValueAtTime(1000, 10)

        filter = ctx.createBiquadFilter();
        filter.type = 'lowpass'

        filter.frequency.setValueAtTime(199, 0)


        osc1.type = "sawtooth"
        osc2.type = "square"
        const gain = ctx.createGain();


        analyser = ctx.createAnalyser();
        analyser.fftSize = 512;
        bufferLength = analyser.frequencyBinCount;
        frequencyInfo = new Uint8Array(bufferLength);
        timeInfo = new Uint8Array(bufferLength);


        osc2.connect(gain);
        osc1.connect(gain);
        gain.connect(filter);
        filter.connect(ctx.destination);


        osc1.frequency.value = 1000
        osc2.frequency.value = 1000
        filter.frequency.value = 10000

        filter.connect(analyser);

        osc1.start()
        osc2.start()
    }

    function initCanvas() {
        canvas = document.getElementById('frequency');
        canvCtx = canvas.getContext('2d');
    }

    function initHandlers() {
        const rangeOsc1 = document.getElementById('osc1-range')
        const rangeOsc2 = document.getElementById('osc2-range')
        const rangeFilter = document.getElementById('filter-range')
        const rangeQFilter = document.getElementById('filter-q')

        rangeOsc1.addEventListener('change', (data) => {
            console.log(data.target.value)
            osc1.frequency.setValueAtTime(data.target.value, 0)
        })

        rangeOsc2.addEventListener('change', (data) => {
            console.log(data.target.value)
            osc2.frequency.setValueAtTime(data.target.value, 0)
        })

        rangeFilter.addEventListener('change', (data) => {
            console.log(data.target.value)
            filter.frequency.setValueAtTime(data.target.value, 0)
        })

        rangeQFilter.addEventListener('change', (data) => {
            console.log(data.target.value)
            filter.Q.setValueAtTime(data.target.value, 0)
        })
    }

    const animate = () => {
        const sliceWidth = 800 /bufferLength;
        analyser.getByteFrequencyData(frequencyInfo);
        analyser.getByteTimeDomainData(timeInfo);
        canvCtx.clearRect(0,0,800, 700)
        canvCtx.moveTo(0,0)
        canvCtx.beginPath();

        for(let i = 0; i < bufferLength; i++) {
            canvCtx.lineTo(i * sliceWidth, 599 - (frequencyInfo[i]))
        }
        canvCtx.stroke();
        requestAnimationFrame(animate)
    }

    initOscillator();
    initHandlers();
    initCanvas();
    animate();
</script>

</body>
</html>
